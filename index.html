<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Shot List Pro PWA</title>

<!-- Mobile viewport -->
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

<!-- PWA Manifest -->
<link rel="manifest" href="manifest.json">

<style>
body{font-family:Arial;background:#0b0b0f;color:#eee;padding:8px;}
h1{text-align:center;}
button{background:#1f1f2a;color:white;border:1px solid #555;padding:6px 10px;margin:3px;border-radius:6px;}
input{background:#111;color:white;border:1px solid #444;padding:5px;border-radius:4px;width:130px;}
.sequence{border:1px solid #444;padding:8px;margin:10px 0;border-radius:8px;background:#151520;}
.plan{display:flex;flex-wrap:wrap;gap:6px;margin:6px 0;padding:6px;border-radius:6px;background:#1b1b27;}
.header{display:flex;flex-wrap:wrap;gap:6px;align-items:center;}
@media (max-width:600px){
  input{width:80%;}
  .plan{flex-direction:column;}
  .header{flex-direction:column;align-items:flex-start;}
}
</style>
</head>

<body>
<h1>ðŸŽ¬ Shot List Pro</h1>
<div id="seqContainer"></div>

<button onclick="addSequence()">âž• Sequence</button>
<button onclick="saveProject()">ðŸ’¾ Save</button>
<button onclick="loadProject()">ðŸ“‚ Load</button>
<button onclick="exportPDF()">â¬‡ Export Production PDF</button>

<script>
if('serviceWorker' in navigator){
  navigator.serviceWorker.register('service-worker.js');
}

let sequences=[];
const recPlan=["Plan d'ensemble","Plan demi ensemble","Plan amÃ©ricain","Plan taille","Plan poitrine","Plan gros","Plan trÃ¨s gros","Plan insert"];
const recAxe=["Profil","Face","De dos","3/4 de dos"];
const recAngle=["HN","PlongÃ©e","Contre plongÃ©e","Bird's eye"];
const recMvt=["CamÃ©ra fixe","Travelling","Panoramique"];
const recSon=["Dialogue","Ambiance","Musique","Silence","Bruitages"];

function datalist(id,arr){return `<datalist id="${id}">${arr.map(v=>`<option value="${v}">`).join("")}</datalist>`;}
function addSequence(){sequences.push({intExt:"INT",dayNight:"DAY",location:"",plans:[]}); render();}
function addPlan(i){sequences[i].plans.push({plan:"",axe:"",angle:"",mvt:"",son:""}); render();}
function deleteSequence(i){sequences.splice(i,1); render();}
function deletePlan(si,pi){sequences[si].plans.splice(pi,1); render();}
function updateField(si,field,value){sequences[si][field]=value;}
function updatePlan(si,pi,field,value){sequences[si].plans[pi][field]=value;}

function render(){
  const c=document.getElementById("seqContainer"); c.innerHTML="";
  sequences.forEach((s,i)=>{
    const div=document.createElement("div"); div.className="sequence";
    div.innerHTML=`<div class="header">
      <b>Sequence ${i+1}</b>
      <select onchange="updateField(${i},'intExt',this.value)">
        <option ${s.intExt=="INT"?"selected":""}>INT</option>
        <option ${s.intExt=="EXT"?"selected":""}>EXT</option>
      </select>
      <select onchange="updateField(${i},'dayNight',this.value)">
        <option ${s.dayNight=="DAY"?"selected":""}>DAY</option>
        <option ${s.dayNight=="NIGHT"?"selected":""}>NIGHT</option>
      </select>
      <input placeholder="Location" value="${s.location}" oninput="updateField(${i},'location',this.value)">
      <button onclick="addPlan(${i})">+ Plan</button>
      <button onclick="deleteSequence(${i})">Delete</button>
    </div>
    <div id="plans${i}"></div>`;
    c.appendChild(div);
    const pDiv=div.querySelector(`#plans${i}`);
    s.plans.forEach((p,j)=>{
      const row=document.createElement("div"); row.className="plan";
      row.innerHTML=`<b>P${j+1}</b>
        <input list="planRec" placeholder="Le plan" value="${p.plan}" oninput="updatePlan(${i},${j},'plan',this.value)">
        <input list="axeRec" placeholder="Axe" value="${p.axe}" oninput="updatePlan(${i},${j},'axe',this.value)">
        <input list="angleRec" placeholder="Angle" value="${p.angle}" oninput="updatePlan(${i},${j},'angle',this.value)">
        <input list="mvtRec" placeholder="Mouvement" value="${p.mvt}" oninput="updatePlan(${i},${j},'mvt',this.value)">
        <input list="sonRec" placeholder="Son" value="${p.son}" oninput="updatePlan(${i},${j},'son',this.value)">
        <button onclick="deletePlan(${i},${j})">Delete</button>`;
      pDiv.appendChild(row);
    });
  });
  document.body.insertAdjacentHTML("beforeend",
    datalist("planRec",recPlan)+
    datalist("axeRec",recAxe)+
    datalist("angleRec",recAngle)+
    datalist("mvtRec",recMvt)+
    datalist("sonRec",recSon)
  );
}

function exportPDF(){
  let html=`<h1 style="text-align:center;">Shot List</h1>`;
  sequences.forEach((s,i)=>{
    html+=`<h2>Sequence ${i+1} â€” ${s.intExt} â€” ${s.dayNight} â€” ${s.location}</h2>
      <table border="1" cellspacing="0" cellpadding="6" width="100%" style="border-collapse:collapse;">
      <tr style="background:#222;color:white;"><th>Plan</th><th>Le plan</th><th>Axe</th><th>Angle</th><th>Mouvement</th><th>Son</th></tr>`;
    s.plans.forEach((p,j)=>{
      html+=`<tr><td>${j+1}</td><td>${p.plan}</td><td>${p.axe}</td><td>${p.angle}</td><td>${p.mvt}</td><td>${p.son}</td></tr>`;
    });
    html+=`</table><br>`;
  });
  const w=window.open("");
  w.document.write(`<body style="background:white;color:black;font-family:Arial;">${html}</body>`);
  w.print();
}

function saveProject(){const blob=new Blob([JSON.stringify(sequences)]); const a=document.createElement("a"); a.href=URL.createObjectURL(blob); a.download="project.json"; a.click();}
function loadProject(){const inp=document.createElement("input"); inp.type="file"; inp.onchange=e=>{const r=new FileReader(); r.onload=()=>{sequences=JSON.parse(r.result); render();}; r.readAsText(e.target.files[0]);}; inp.click();}

render();
</script>
</body>
</html>