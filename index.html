<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Shot List Pro PWA</title>

<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="manifest" href="manifest.json">

<style>
body{font-family:Arial;background:#0b0b0f;color:#eee;padding:8px;}
h1{text-align:center;}
button{background:#1f1f2a;color:white;border:1px solid #555;padding:6px 10px;margin:3px;border-radius:6px;}
input, textarea{
  background:#111;color:white;border:1px solid #444;
  padding:5px;border-radius:4px;width:130px;
}
textarea{
  width:100%;
  min-height:70px;
  resize:vertical;
}
.sequence{
  border:1px solid #444;
  padding:8px;
  margin:12px 0;
  border-radius:8px;
  background:#151520;
}
.plan{
  display:flex;
  flex-wrap:wrap;
  gap:6px;
  margin:6px 0;
  padding:6px;
  border-radius:6px;
  background:#1b1b27;
}
.header{
  display:flex;
  flex-wrap:wrap;
  gap:6px;
  align-items:center;
}
@media (max-width:600px){
  input{width:100%;}
  .plan{flex-direction:column;}
  .header{flex-direction:column;align-items:flex-start;}
}
</style>
</head>

<body>

<h1>ðŸŽ¬ Shot List Pro</h1>
<div id="seqContainer"></div>

<button onclick="addSequence()">âž• Sequence</button>
<button onclick="saveProject()">ðŸ’¾ Save</button>
<button onclick="loadProject()">ðŸ“‚ Load</button>
<button onclick="exportPDF()">â¬‡ Export PDF</button>

<script>

if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('service-worker.js');
}

let sequences = [];

// ---------- SEQUENCE ----------

function addSequence(){
  sequences.push({
    intExt:"INT",
    dayNight:"DAY",
    location:"",
    action:"",
    plans:[]
  });
  render();
}

function deleteSequence(i){
  sequences.splice(i,1);
  render();
}

// ---------- PLAN ----------

function addPlan(i){
  sequences[i].plans.push({
    plan:"", axe:"", angle:"", mvt:"", son:""
  });
  render();
}

function deletePlan(si,pi){
  sequences[si].plans.splice(pi,1);
  render();
}

// ---------- UPDATE ----------

function updateField(si, field, value){
  sequences[si][field] = value;
}

function updatePlan(si,pi,field,value){
  sequences[si].plans[pi][field] = value;
}

// ---------- RENDER ----------

function render(){
  const container = document.getElementById("seqContainer");
  container.innerHTML = "";

  sequences.forEach((seq, i) => {

    const seqDiv = document.createElement("div");
    seqDiv.className = "sequence";

    seqDiv.innerHTML = `
      <div class="header">
        <b>Sequence ${i+1}</b>

        <select onchange="updateField(${i},'intExt',this.value)">
          <option ${seq.intExt==="INT"?"selected":""}>INT</option>
          <option ${seq.intExt==="EXT"?"selected":""}>EXT</option>
        </select>

        <select onchange="updateField(${i},'dayNight',this.value)">
          <option ${seq.dayNight==="DAY"?"selected":""}>DAY</option>
          <option ${seq.dayNight==="NIGHT"?"selected":""}>NIGHT</option>
        </select>

        <input placeholder="Location"
          value="${seq.location}"
          oninput="updateField(${i},'location',this.value)">

        <button onclick="addPlan(${i})">+ Plan</button>
        <button onclick="deleteSequence(${i})">Delete</button>
      </div>

      <div style="margin-top:10px;">
        <b>Action (What happens in this sequence)</b>
        <textarea
          placeholder="Describe what happens..."
          oninput="updateField(${i},'action',this.value)"></textarea>
      </div>

      <div id="plans-${i}"></div>

      <div style="margin-top:8px;">
        <button onclick="addPlan(${i})">+ Add Plan</button>
      </div>
    `;

    container.appendChild(seqDiv);

    seqDiv.querySelector("textarea").value = seq.action;

    const plansContainer = seqDiv.querySelector(`#plans-${i}`);

    seq.plans.forEach((plan, j) => {

      const planDiv = document.createElement("div");
      planDiv.className = "plan";

      planDiv.innerHTML = `
        <b>P${j+1}</b>

        <input placeholder="Le plan"
          value="${plan.plan}"
          oninput="updatePlan(${i},${j},'plan',this.value)">

        <input placeholder="Axe"
          value="${plan.axe}"
          oninput="updatePlan(${i},${j},'axe',this.value)">

        <input placeholder="Angle"
          value="${plan.angle}"
          oninput="updatePlan(${i},${j},'angle',this.value)">

        <input placeholder="Mouvement"
          value="${plan.mvt}"
          oninput="updatePlan(${i},${j},'mvt',this.value)">

        <input placeholder="Son"
          value="${plan.son}"
          oninput="updatePlan(${i},${j},'son',this.value)">

        <button onclick="deletePlan(${i},${j})">Delete</button>
      `;

      plansContainer.appendChild(planDiv);
    });

  });
}

// ---------- SAVE ----------

function saveProject(){
  const blob = new Blob([JSON.stringify(sequences, null, 2)], {type:"application/json"});
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "shotlist-project.json";
  a.click();
}

// ---------- LOAD ----------

function loadProject(){
  const input = document.createElement("input");
  input.type = "file";
  input.accept = ".json";

  input.onchange = e => {
    const file = e.target.files[0];
    const reader = new FileReader();

    reader.onload = () => {
      try{
        sequences = JSON.parse(reader.result);
        render();
      }catch(err){
        alert("Invalid file format.");
      }
    };

    reader.readAsText(file);
  };

  input.click();
}

// ---------- EXPORT ----------

function exportPDF(){

  let html = `<h1 style="text-align:center;">Shot List</h1>`;

  sequences.forEach((s,i)=>{

    html += `
      <h2>Sequence ${i+1} â€” ${s.intExt} â€” ${s.dayNight} â€” ${s.location}</h2>

      <div style="margin-bottom:10px;padding:8px;background:#eee;border-radius:6px;">
        <b>Action:</b><br>${s.action}
      </div>

      <table border="1" cellspacing="0" cellpadding="6" width="100%" style="border-collapse:collapse;">
        <tr style="background:#222;color:white;">
          <th>#</th>
          <th>Le plan</th>
          <th>Axe</th>
          <th>Angle</th>
          <th>Mouvement</th>
          <th>Son</th>
        </tr>
    `;

    s.plans.forEach((p,j)=>{
      html += `
        <tr>
          <td>${j+1}</td>
          <td>${p.plan}</td>
          <td>${p.axe}</td>
          <td>${p.angle}</td>
          <td>${p.mvt}</td>
          <td>${p.son}</td>
        </tr>
      `;
    });

    html += `</table><br>`;
  });

  const w = window.open("");
  w.document.write(`<body style="font-family:Arial;color:black;">${html}</body>`);
  w.print();
}

render();

</script>
</body>
</html>